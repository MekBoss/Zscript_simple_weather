//thinker responsible for spawning weather actors
class thundercloud : thinker
{
    //position on a map around which thinker should spawn snow/rain
    private vector2 map_spot;
    //distance to check around map point is player inside
    //and to determine how fasr away from map spot weather should have spawns
    private vector2 check_distances;

    private sector_cyclon origin_thinker;
    private double min_z_height;
    private double player_camera_height;
    private uint timer;

    thundercloud init(vector2 v, sector_cyclon it, vector2 d)
    {
        map_spot = v;
        origin_thinker = it;
        check_distances = d;
        min_z_height = interval_between_points * 3;

        return self;
    }

    //check is any player near weather spawning point
    private bool player_nearby()
    {
        bool is_looking = false;
        for (int i = 0; i < MAXPLAYERS; i++)
        {
            PlayerInfo p = players[i];
            
            if (p != null && p.camera != null)
            {
                if(abs(p.camera.pos.x - map_spot.x) <= check_distances.x * 2 && abs(p.camera.pos.y - map_spot.y) <= check_distances.y * 2)
                {
                    player_camera_height = p.camera.pos.z;
                    is_looking = true;
                    break;
                }
            }
        }
        return is_looking;
    }

    override void tick()
    {
        //if level is frozen return to not spawn >90000 weather actors
        if(!CWE_weather || globalfreeze) return;

        timer ++;
        
        if(timer >= CWE_intensity)
        {
            timer = 0;
            if(player_nearby() )
            {
                vector3 v =
                (
                    map_spot.x + frandom(-check_distances.x, check_distances.x),
                    map_spot.y + frandom(-check_distances.y, check_distances.y),
                    player_camera_height + min_z_height
                );

                sector_cyclon(origin_thinker).raining_men(v);
            }
        }
    }

}